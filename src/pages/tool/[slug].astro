---
import Layout from '../../layouts/Layout.astro';
import aiData from '../../data/ai_tools.json';
import macData from '../../data/mac_tools.json';

// 1. ÂêàÂπ∂‰∏§‰∏™Êï∞ÊçÆÊ∫ê
const allTools = [...aiData, ...macData];

// 2. ÁîüÊàêÊâÄÊúâÈ°µÈù¢ÁöÑË∑ØÂæÑ
export async function getStaticPaths() {
  // ÈáçÊñ∞ÂºïÂÖ•Êï∞ÊçÆ‰ª•Á°Æ‰øù‰ΩúÁî®Âüü
  const aiData = (await import('../../data/ai_tools.json')).default;
  const macData = (await import('../../data/mac_tools.json')).default;
  const all = [...aiData, ...macData];

  return all.map((tool) => ({
    params: { slug: tool.slug || tool.name.toLowerCase().replace(/\s+/g, '-') },
    props: { tool },
  }));
}

const { tool } = Astro.props;

// 3. ÂáÜÂ§á Slug ÈõÜÂêàÁî®‰∫éÊ£ÄÊü•Êõø‰ª£ÂìÅÈìæÊé•ÊòØÂê¶ÊúâÊïà
const existingSlugs = new Set(allTools.map(t => t.slug || t.name.toLowerCase().replace(/\s+/g, '-')));

// È°µÈù¢Ê†áÈ¢ò
const pageTitle = `${tool.name} Review - Best ${tool.collection === 'mac' ? 'Mac App' : 'AI Tool'} (2025)`;
const pageDesc = tool.description ? tool.description.slice(0, 150) + "..." : "";
---

<Layout title={pageTitle} description={pageDesc}>
  <div class="text-sm text-slate-500 mb-4 flex items-center gap-2">
    <a href="/" class="hover:underline">Home</a> 
    <span>&rsaquo;</span>
    <span class="capitalize">{tool.collection === 'mac' ? 'Mac Apps' : 'AI Tools'}</span>
    <span>&rsaquo;</span>
    <span class="text-slate-800 font-medium">{tool.name}</span>
  </div>

  <header class="mb-8">
    <div class="flex items-center gap-3 mb-2">
        <h1 class="text-4xl font-extrabold">{tool.name}</h1>
        {tool.collection === 'mac' ? (
            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-bold uppercase tracking-wider">Mac App</span>
        ) : (
            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-bold uppercase tracking-wider">AI Tool</span>
        )}
    </div>
    
    <p class="text-xl text-slate-600 mb-6 max-w-2xl">{tool.tagline}</p>
    
    <div class="flex flex-wrap gap-3 mb-8">
      <span class="px-3 py-1 border border-slate-200 rounded-full text-sm text-slate-600">
        üí∞ {tool.pricing_type}
      </span>
      {tool.category && (
        <a href={`/category/${tool.category.toLowerCase().replace(/\s+/g, '-')}`} class="px-3 py-1 border border-slate-200 rounded-full text-sm text-blue-600 hover:bg-blue-50 transition">
          üìÇ {tool.category}
        </a>
      )}
    </div>

    <a href={tool.website_url || `https://www.google.com/search?q=${encodeURIComponent(tool.name)}`} 
       target="_blank" 
       rel="nofollow noopener"
       onclick={`gtag('event', 'click_affiliate', { 'tool_name': '${tool.name}', 'url': '${tool.website_url || "google_search"}', 'category': '${tool.collection}' });`}
       class={`inline-flex items-center gap-2 px-8 py-3 rounded-lg font-bold text-white transition shadow-lg shadow-blue-500/20 ${tool.collection === 'mac' ? 'bg-purple-600 hover:bg-purple-700' : 'bg-blue-600 hover:bg-blue-700'}`}>
       Visit Official Website 
       <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
    </a>
  </header>

  <div class="grid md:grid-cols-3 gap-8">
    <div class="md:col-span-2 space-y-8">
      <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
        <h2 class="text-2xl font-bold mb-4">Overview</h2>
        <p class="text-slate-700 leading-relaxed text-lg">{tool.description}</p>
      </section>

      {tool.key_features && (
          <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
            <h2 class="text-2xl font-bold mb-4">Key Features</h2>
            <ul class="grid sm:grid-cols-2 gap-3">
              {tool.key_features.map((feature) => (
                <li class="flex items-start gap-2 text-slate-700">
                  <svg class="w-5 h-5 text-green-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                  <span>{feature}</span>
                </li>
              ))}
            </ul>
          </section>
      )}

      <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
        <h2 class="text-2xl font-bold mb-4">Alternatives to {tool.name}</h2>
        <div class="space-y-3">
            {tool.alternatives && tool.alternatives.map((alt) => {
                const altSlug = alt.toLowerCase().replace(/\s+/g, '-');
                const exists = existingSlugs.has(altSlug);
                return (
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg group hover:bg-slate-100 transition">
                        <span class="font-medium text-slate-700">{alt}</span>
                        {exists ? (
                            <a href={`/tool/${altSlug}`} class="text-sm font-bold text-blue-600 hover:underline">Compare &rarr;</a>
                        ) : (
                            <a href={`https://www.google.com/search?q=${encodeURIComponent(alt + ' ' + tool.name + ' alternative')}`} target="_blank" rel="nofollow noopener" class="text-xs text-slate-400 hover:text-slate-600 flex items-center gap-1">Search <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a>
                        )}
                    </div>
                );
            })}
        </div>
      </section>
    </div>

    <div class="space-y-6">
      <div class="bg-green-50 p-6 rounded-xl border border-green-100">
        <h3 class="font-bold text-green-800 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg>
            Pros
        </h3>
        <ul class="space-y-3">
          {tool.pros && tool.pros.map((pro) => (
            <li class="flex items-start gap-2 text-sm text-green-900">
              <span class="text-green-500 mt-0.5">‚úì</span> {pro}
            </li>
          ))}
        </ul>
      </div>

      <div class="bg-red-50 p-6 rounded-xl border border-red-100">
        <h3 class="font-bold text-red-800 mb-4 flex items-center gap-2">
             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.095c.5 0 .905-.405.905-.905 0-.714.211-1.412.608-2.006L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"></path></svg>
            Cons
        </h3>
        <ul class="space-y-3">
          {tool.cons && tool.cons.map((con) => (
            <li class="flex items-start gap-2 text-sm text-red-900">
              <span class="text-red-500 mt-0.5">√ó</span> {con}
            </li>
          ))}
        </ul>
      </div>
    </div>
  </div>
</Layout>