---
import Layout from '../../layouts/Layout.astro';

// 1. ç”Ÿæˆæ‰€æœ‰åˆ†ç±»çš„è·¯å¾„
export async function getStaticPaths() {
  const aiData = (await import('../../data/ai_tools.json')).default;
  const macData = (await import('../../data/mac_tools.json')).default;
  const allTools = [...aiData, ...macData];

  // æå–åˆ†ç±»
  const uniqueCategories = [...new Set(allTools.map(tool => tool.category).filter(Boolean))];
  
  return uniqueCategories.map((category) => {
    const categoryTools = allTools.filter((tool) => tool.category === category);
    
    // ğŸ”´ æ ¸å¿ƒä¿®å¤ï¼šå¼ºåŠ›æ¸…æ´— Slug
    // 1. è½¬å°å†™
    // 2. æŠŠæ‰€æœ‰éå­—æ¯æ•°å­—çš„å­—ç¬¦ (åŒ…æ‹¬ç©ºæ ¼ã€æ–œæ ã€&) éƒ½æ›¿æ¢æˆ '-'
    // 3. å»æ‰å¤´å°¾å¤šä½™çš„ '-'
    const safeSlug = category.toLowerCase()
        .replace(/[^a-z0-9]+/g, '-') 
        .replace(/^-+|-+$/g, '');

    return {
      params: { slug: safeSlug },
      props: { categoryName: category, tools: categoryTools },
    };
  });
}

const { categoryName, tools } = Astro.props;
---

<Layout title={`Best ${categoryName} Tools (2025)`} description={`Compare the best ${categoryName} software and AI tools.`}>
  <div class="mb-8">
    <a href="/" class="text-sm text-blue-600 hover:underline flex items-center gap-1">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
      Back to All Tools
    </a>
    <h1 class="text-4xl font-extrabold mt-4 mb-2">{categoryName} Tools</h1>
    <p class="text-xl text-slate-600">Found {tools.length} tools in this category.</p>
  </div>

  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    {tools.map((tool) => (
      <a href={`/tool/${tool.slug || tool.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '')}`} 
         class={`block bg-white p-6 rounded-xl shadow-sm border hover:shadow-md transition group ${tool.collection === 'mac' ? 'border-slate-200 hover:border-purple-300' : 'border-slate-200 hover:border-blue-300'}`}>
        <div class="flex justify-between items-start mb-2">
            <h2 class={`text-xl font-bold text-slate-900 ${tool.collection === 'mac' ? 'group-hover:text-purple-600' : 'group-hover:text-blue-600'}`}>{tool.name}</h2>
            {tool.collection === 'mac' ? (
                <span class="text-[10px] uppercase font-bold px-2 py-1 bg-purple-50 text-purple-600 rounded">Mac</span>
            ) : (
                <span class="text-[10px] uppercase font-bold px-2 py-1 bg-blue-50 text-blue-600 rounded">AI</span>
            )}
        </div>
        <p class="text-sm text-slate-500 mb-4 line-clamp-2">{tool.tagline}</p>
        <div class="flex items-center justify-between mt-auto">
            <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">{tool.pricing_type}</span>
            <span class={`text-xs font-semibold ${tool.collection === 'mac' ? 'text-purple-600' : 'text-blue-600'}`}>View Details &rarr;</span>
        </div>
      </a>
    ))}
  </div>
</Layout>